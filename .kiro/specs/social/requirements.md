# Requirements Document

## Introduction
ソーシャル機能は、ヒビオル（hibioru）に軽量なソーシャル要素を追加し、ユーザー同士が互いの継続を称え合う仕組みを提供する。SNS化を避け、ADHD当事者への配慮として過剰な中毒性を持たせないよう設計する。具体的には、お祝いされた数やフォロー/フォロワー数は他のユーザーには表示しない。

## Non-Goals
- いいね数やフォロワー数のランキング・比較機能
- 公開プロフィールページ
- ダイレクトメッセージ機能
- コメント機能

## Requirements

### Requirement 1: 共有投稿
**Objective:** ユーザーとして、自分の投稿をフォロワーに共有したい。これにより、日々の記録をフォロワーと共有し、応援してもらえる。

#### Acceptance Criteria
1. When ユーザーが投稿フォームで「フォロワーに共有」トグルをオンにする, the システム shall その投稿を`is_shared`フラグ付きで保存する
2. When 共有投稿が作成される, the システム shall `shared_entry`タイプの達成イベントを自動作成する
3. The 共有トグル shall デフォルトでオフとする
4. When ユーザーが既存投稿を編集する, the システム shall 共有状態を変更可能とする

### Requirement 2: フォロー機能
**Objective:** ユーザーとして、他のユーザーをフォローして彼らの達成を見守りたい。これにより、仲間の継続を応援できる。

#### Acceptance Criteria
1. When ユーザーが他のユーザーをフォローする, the システム shall フォロー関係を`follows`テーブルに保存する
2. The システム shall 自分自身をフォローすることを禁止する
3. When ユーザーが既にフォロー中のユーザーに対してフォロー操作を行う, the システム shall エラーメッセージを返す
4. When ユーザーがフォロー解除する, the システム shall フォロー関係を削除する
5. The ユーザー shall 自分のフォロー数とフォロワー数を確認できる
6. The システム shall 他のユーザーのフォロー数・フォロワー数を表示しない

### Requirement 3: ソーシャルフィード
**Objective:** ユーザーとして、フォロー中のユーザーの達成や共有投稿を閲覧したい。これにより、仲間の頑張りを確認し、応援できる。

#### Acceptance Criteria
1. The ソーシャルフィード shall フォロー中のユーザーの達成イベントを新しい順で表示する
2. The ソーシャルフィード shall フォロー中のユーザーの共有投稿を表示する
3. When ユーザーがフィードの下部に到達する, the システム shall 無限スクロールで過去のアイテムを読み込む（20件/ページ）
4. The システム shall Supabase Realtimeで新しい達成をリアルタイム受信する
5. When フォロー前に達成されたイベントがある, the システム shall 各ユーザーにつき最新1件のみをフィードに表示する

### Requirement 4: 達成イベント
**Objective:** ユーザーとして、投稿数や継続日数の達成を記録したい。これにより、自分の成長を可視化し、フォロワーにも共有できる。

#### Acceptance Criteria
1. The システム shall 以下の4種類の達成を記録する:
   - `daily_posts`: 1日の投稿数（閾値: 5, 10, 15, 20）
   - `total_posts`: 総投稿数（閾値: 10, 50, 100, 250, 500, 1000）
   - `streak_days`: 継続日数（閾値: 3, 7, 14, 30, 60, 100, 365）
   - `shared_entry`: 共有投稿（閾値なし、共有ごとに達成）
2. When ユーザーが投稿を作成する, the システム shall 達成閾値を超えたかチェックする
3. When 閾値を超えた, the システム shall 達成イベントを`achievements`テーブルに記録する
4. The システム shall 同じ閾値の達成を重複して記録しない

### Requirement 5: お祝い機能
**Objective:** ユーザーとして、他のユーザーの達成をお祝いしたい。これにより、応援の気持ちを伝えられる。

#### Acceptance Criteria
1. When ユーザーがフィードアイテムをタップする, the システム shall お祝いを送信する
2. When お祝いを送信する, the システム shall パーティクルエフェクトを表示する
3. When 既にお祝い済みのアイテムをタップする, the システム shall お祝いを取り消す
4. The システム shall 同じ達成への重複お祝いを禁止する
5. The フィード shall お祝い済みのアイテムを視覚的に区別する（色変更）
6. The フィード shall お祝い数を他のユーザーには表示しない

### Requirement 6: ソーシャル通知
**Objective:** ユーザーとして、お祝いやフォローの通知を受け取りたい。これにより、応援してくれた人を確認できる。

#### Acceptance Criteria
1. When 他のユーザーがお祝いを送信する, the システム shall `celebration`タイプの通知を作成する
2. When 他のユーザーがフォローする, the システム shall `follow`タイプの通知を作成する
3. The 通知タブ shall 未読通知数をバッジで表示する
4. When ユーザーが通知を閲覧する, the システム shall 既読マークを付ける
5. The 通知 shall 誰からの通知かを表示する（アバター、表示名、ユーザー名）
6. When ソーシャル通知のブラウザ通知が有効な場合, the システム shall プッシュ通知を送信する
7. The ユーザー shall ソーシャル通知のブラウザ通知のオン/オフを設定できる

### Requirement 7: プロフィール管理
**Objective:** ユーザーとして、表示名とユーザー名を設定したい。これにより、他のユーザーに認識されやすくなる。

#### Acceptance Criteria
1. The ユーザー shall 表示名を設定できる
2. The ユーザー shall ユーザー名（一意識別子）を設定できる
3. The ユーザー名 shall 3〜20文字の英数字とアンダースコアのみ使用可能
4. When 既に使用されているユーザー名を設定しようとする, the システム shall エラーメッセージを表示する
5. The システム shall ユーザー名でユーザー検索機能を提供する
6. The 検索結果 shall アバター、表示名、ユーザー名を表示する
