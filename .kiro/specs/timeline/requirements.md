# Requirements Document

## Introduction
タイムライン/カレンダーページは、ヒビオル（hibioru）のメイン画面（`/`）として機能し、ユーザーの日々の記録を時系列で表示する。日付ヘッダー、投稿一覧、月カレンダー表示、スクロール連動機能を通じて、ADHD当事者が自分の継続を可視化し、「記録が目に見える形で残る」体験を提供する。

## Requirements

### Requirement 1: 日付ヘッダーナビゲーション
**Objective:** ユーザーとして、日付ヘッダーを操作して特定の日付に素早く移動したい。これにより、過去の記録を効率的に振り返ることができる。

#### Acceptance Criteria
1. When ユーザーが日付ヘッダーを左にスワイプする, the タイムラインページ shall 前日の日付に移動する
2. When ユーザーが日付ヘッダーを右にスワイプする, the タイムラインページ shall 翌日の日付に移動する
3. When ユーザーが日付ヘッダーの「N月」表示をタップする, the タイムラインページ shall 月カレンダーを展開表示する
4. While 月カレンダーが展開されている, when ユーザーが特定の日付をタップする, the タイムラインページ shall その日付の投稿位置までスクロールする

### Requirement 2: タイムライン投稿一覧表示
**Objective:** ユーザーとして、自分の投稿を時系列で閲覧したい。これにより、日々の記録を振り返り、継続を実感できる。

#### Acceptance Criteria
1. The タイムラインページ shall 投稿を新しい順（上が新しい）で表示する
2. The タイムラインページ shall 日付をまたいで連続スクロール可能とする
3. When ユーザーがスクロールして日付境界を越える, the タイムラインページ shall 日付単位でスナップアニメーションを適用する
4. When タイムラインページが初期表示される, the タイムラインページ shall 今日の最終投稿位置を表示する

### Requirement 3: 日付とスクロール位置の同期
**Objective:** ユーザーとして、現在見ている投稿の日付を常に把握したい。これにより、どの日の記録を見ているか混乱しない。

#### Acceptance Criteria
1. While ユーザーがタイムラインをスクロールしている, the 日付ヘッダー shall 現在表示中の投稿の日付と同期して更新される
2. When スクロールにより表示日付が変更される, the 日付ヘッダー shall 新しい日付を即座に反映する

### Requirement 4: 空の日（投稿なし日）の処理
**Objective:** ユーザーとして、投稿がない日をスキップしつつ、「ほつれ」を使用した日を視覚的に確認したい。これにより、継続の状況を正確に把握できる。

#### Acceptance Criteria
1. While タイムラインをスクロールしている, when 投稿のない日がある, the タイムラインページ shall その日をスキップして次の投稿がある日へ移動する
2. Where ほつれ機能が使用された日がある, the 日付ヘッダー shall その日に🧵マークを表示する

### Requirement 5: 投稿カード表示と操作
**Objective:** ユーザーとして、投稿カードを閲覧・操作して記録を確認・編集したい。これにより、記録の振り返りと修正が容易になる。

#### Acceptance Criteria
1. The 投稿カード shall テキスト内容、添付画像（ある場合）、投稿時刻を表示する
2. When ユーザーが投稿カードをタップする, the タイムラインページ shall 編集ページ（`/edit/[id]`）へ遷移する
3. The 投稿カード shall 添付画像をタップしても拡大表示しない（投稿に付属表示のみ）

### Requirement 6: 月カレンダー表示
**Objective:** ユーザーとして、月単位で記録状況を俯瞰したい。これにより、継続パターンや空白期間を視覚的に把握できる。

#### Acceptance Criteria
1. When 月カレンダーが表示される, the 月カレンダー shall 記録がある日に●マークを表示する
2. When 月カレンダーが表示される, the 月カレンダー shall 連続記録日に━━（継続線）を表示する
3. When 月カレンダーが表示される and ほつれを使用した日がある, the 月カレンダー shall その日に🧵マークを表示する
4. The 月カレンダー shall 今日の日付を◎マークで強調表示する
5. When ユーザーが月カレンダー外の領域をタップする, the タイムラインページ shall 月カレンダーを閉じる

### Requirement 7: データ読み込みとパフォーマンス
**Objective:** ユーザーとして、どのデバイスでも快適にタイムラインを閲覧したい。これにより、スマートフォンでもPCでもストレスなく使用できる。

#### 大原則: 読み込んでから移動
**タイムラインの日付移動は、必ず「データを読み込んでから移動」する方式とする。** URL遷移によるページリロードではなく、バックグラウンドでデータを取得してからスムーススクロールで移動することで、シームレスなユーザー体験を提供する。

#### Acceptance Criteria
1. The タイムラインページ shall モバイルデバイスとデスクトップデバイスの両方で適切に表示される
2. When タイムラインページが初期表示される, the システム shall 直近5日間の投稿データを読み込む
3. When タイムラインページが初期表示される, the システム shall 一番下（最新の日付の最後の投稿）にスクロール位置を設定する
4. When 投稿の新規作成または編集が完了してタイムラインに戻った場合, the システム shall 一番下（最新の日付の最後の投稿）にスクロール位置を設定する
5. When ユーザーが日付ヘッダーを過去方向にスワイプする, the システム shall 中央に表示される日付から-5日分のデータを追加読み込みする
6. When ユーザーがタイムラインを上にスクロールして一番上に到達する, the システム shall 過去のデータを追加読み込みする
7. When ユーザーが未読み込み日付に移動する（日付ヘッダースワイプ、カレンダー選択）, the システム shall その日付までのデータをバックグラウンドで読み込んでからスムーススクロールでジャンプする
8. The タイムラインページ shall 無限スクロール形式で記録がある限り過去に遡ることができる
9. If 投稿データの取得に失敗した, the タイムラインページ shall エラーメッセージを表示し、リトライオプションを提供する
