# E2Eカバレッジレポート: 仕様とテストの対応状況

仕様書の要件とE2Eテストの対応状況を分析し、カバレッジレポートを生成します。

## 実行手順

### 1. 全仕様の読み込み

以下の仕様ファイルを全て読み込んでください：

```
docs/REQUIREMENTS.md                         # 全体要件
.kiro/specs/auth/requirements.md             # 認証
.kiro/specs/timeline/requirements.md         # タイムライン
.kiro/specs/entry-input/requirements.md      # 入力/編集
.kiro/specs/streak/requirements.md           # ストリーク
.kiro/specs/mypage/requirements.md           # マイページ
.kiro/specs/notification/requirements.md     # 通知
```

### 2. 全テストの読み込み

`e2e/` ディレクトリ内の全テストファイルを読み込んでください。

### 3. マッピング分析

各仕様要件に対して、対応するテストの有無を分析します。

### 4. レポート生成

以下の形式で詳細なカバレッジレポートを生成してください：

```markdown
# E2Eテストカバレッジレポート

**生成日時**: YYYY-MM-DD HH:mm

## エグゼクティブサマリー

| 指標 | 値 |
|------|-----|
| 総要件数 | X |
| カバー済み | X (XX%) |
| 部分カバー | X (XX%) |
| 未カバー | X (XX%) |
| 総テスト数 | X |
| 成功率 | XX% |

### 品質スコア
**[A/B/C/D/F]** - [スコアの説明]

- A (90%+): 本番リリース可能
- B (80-89%): 軽微な追加で本番可能
- C (60-79%): 追加テストが必要
- D (40-59%): 重大なギャップあり
- F (<40%): 大幅な作業が必要

---

## 機能別カバレッジ

### 1. 認証機能 (auth)

**カバレッジ: XX%** ████████░░

| # | 要件 | テスト | ステータス |
|---|------|--------|-----------|
| AUTH-001 | ログインページ表示 | auth.spec.ts:L8 | ✅ |
| AUTH-002 | Googleボタン表示 | auth.spec.ts:L14 | ✅ |
| AUTH-003 | 未認証リダイレクト | auth.spec.ts:L22 | ✅ |
| AUTH-004 | エラーハンドリング | auth.spec.ts:L29 | ✅ |

**未カバー要件**: なし

---

### 2. タイムライン (timeline)

**カバレッジ: XX%** ████░░░░░░

| # | 要件 | テスト | ステータス |
|---|------|--------|-----------|
| TL-001 | 投稿一覧表示 | - | ❌ 未実装 |
| TL-002 | 日付ヘッダー操作 | - | ❌ 未実装 |

**未カバー要件**:
- [ ] 投稿一覧の表示
- [ ] 日付スワイプ操作
- [ ] カレンダー展開

---

### 3. 入力/編集 (entry-input)
[同様の形式で記載]

### 4. ストリーク (streak)
[同様の形式で記載]

### 5. マイページ (mypage)
[同様の形式で記載]

### 6. 通知 (notification)
[同様の形式で記載]

---

## Phase 1 要件チェックリスト

docs/REQUIREMENTS.md のPhase 1項目との対応：

| # | Phase 1 要件 | 実装 | テスト | ステータス |
|---|--------------|------|--------|-----------|
| 1 | Next.js + Supabase + Vercel構築 | ✅ | - | 🔧 環境 |
| 2 | Google認証 | ✅ | ✅ | ✅ 完了 |
| 3 | 入力/編集ページ | ? | ? | ? |
| 4 | タイムライン/カレンダーページ | ? | ? | ? |
| 5 | マイページ（継続記録表示） | ? | ? | ? |
| 6 | ストリーク/ほつれロジック | ? | ? | ? |
| 7 | 画像圧縮・アップロード | ? | ? | ? |
| 8 | PWA化 | ? | ? | ? |
| 9 | プッシュ通知（メインリマインド） | ? | ? | ? |
| 10 | データエクスポートAPI | ? | ? | ? |

---

## 優先度別アクションアイテム

### 🔴 Critical（即時対応）
- [ ] [項目] - 理由: [説明]

### 🟠 High（今週中）
- [ ] [項目] - 理由: [説明]

### 🟡 Medium（今月中）
- [ ] [項目] - 理由: [説明]

### 🟢 Low（余裕があれば）
- [ ] [項目] - 理由: [説明]

---

## 推奨ワークフロー

現在の状況に基づく推奨アクション：

1. `/e2e:generate [機能名]` - 未カバー機能のテスト追加
2. `/e2e:fix [機能名]` - 失敗テストの修正
3. `/e2e:verify-all` - 全体の再検証

---

## テストメンテナンス情報

| テストファイル | テスト数 | 最終更新 | 健全性 |
|---------------|----------|----------|--------|
| auth.spec.ts | 9 | [日付] | 🟢 良好 |
| timeline.spec.ts | - | - | ⚪ 未作成 |

---

## 付録: 要件トレーサビリティマトリクス

全要件とテストの完全な対応表を別途出力可能。
```

### 5. レポートの保存（オプション）

ユーザーが希望する場合、レポートを以下に保存：
```
docs/E2E_COVERAGE_REPORT.md
```

### 6. 次のステップ提案

カバレッジ状況に応じて適切なコマンドを提案：

| カバレッジ | 推奨アクション |
|-----------|---------------|
| 90%+ | 「本番リリースの準備が整っています」 |
| 70-89% | `/e2e:generate` でカバレッジ向上 |
| 50-69% | 複数機能のテスト追加が必要 |
| <50% | 体系的なテスト計画の策定を推奨 |

## カバレッジ計算方法

### 要件のカウント
- EARS形式の要件（.kiro/specs/*/requirements.md）
- docs/REQUIREMENTS.md の機能要件

### カバー判定
- ✅ カバー済み: 該当テストが存在し、成功している
- ⚠️ 部分カバー: テストは存在するが一部失敗または不完全
- ❌ 未カバー: 該当テストが存在しない

### スコア計算
```
カバレッジ% = (カバー済み + 部分カバー×0.5) / 総要件数 × 100
```
