# E2Eテスト生成: 仕様からテストを自動生成

指定された機能の仕様書を読み込み、E2Eテストを自動生成します。

## 引数
- `$ARGUMENTS`: テストを生成する機能名（auth, timeline, entry-input, streak, mypage, notification）

## 実行手順

### 1. 仕様の読み込み
以下のファイルから該当機能の仕様を詳細に読み込んでください：

```
.kiro/specs/$ARGUMENTS/requirements.md  ← 要件定義（EARS形式）
.kiro/specs/$ARGUMENTS/design.md        ← 技術設計
.kiro/specs/$ARGUMENTS/tasks.md         ← 実装タスク
docs/REQUIREMENTS.md                     ← 全体要件（関連セクション）
```

### 2. 既存テストの確認
`e2e/` ディレクトリ内の既存テストを確認し、重複を避けてください。

### 3. テストケースの設計

仕様から以下の観点でテストケースを抽出してください：

#### 機能テスト（Functional）
- ユーザーストーリーに基づくハッピーパス
- 各画面要素の存在と表示
- 入力・操作に対する正しいレスポンス

#### エッジケース（Edge Cases）
- 境界値（最大/最小/空）
- 異常系（エラー状態、タイムアウト）
- 権限・認証状態の違い

#### ユーザビリティ（UX）
- アクセシビリティ（aria-label、キーボード操作）
- レスポンシブ対応
- ローディング状態

### 4. テストファイルの生成

以下のテンプレートに従ってテストを生成してください：

```typescript
import { test, expect } from '@playwright/test'

/**
 * [機能名]のE2Eテスト
 *
 * 仕様書: .kiro/specs/$ARGUMENTS/requirements.md
 *
 * テスト対象:
 * - [主要な検証項目1]
 * - [主要な検証項目2]
 */

test.describe('[機能名]', () => {
  // === ハッピーパス ===
  test.describe('正常系', () => {
    test('[テスト名]', async ({ page }) => {
      // Given: [前提条件]
      await page.goto('[URL]')

      // When: [操作]
      await page.click('[セレクタ]')

      // Then: [期待結果]
      await expect(page.locator('[セレクタ]')).toBeVisible()
    })
  })

  // === エッジケース ===
  test.describe('異常系', () => {
    test('[エラーケース]', async ({ page }) => {
      // ...
    })
  })

  // === アクセシビリティ ===
  test.describe('アクセシビリティ', () => {
    test('[a11yテスト]', async ({ page }) => {
      // ...
    })
  })
})
```

### 5. テストの出力先
```
e2e/$ARGUMENTS.spec.ts
```

既存ファイルがある場合は、不足しているテストケースのみを追加してください。

### 6. 生成後の確認

生成したテストを実行して動作確認：
```bash
npx playwright test e2e/$ARGUMENTS.spec.ts --reporter=list
```

### 7. レポート

```markdown
## テスト生成レポート: [機能名]

### 生成されたテスト
| # | テスト名 | カテゴリ | 検証内容 |
|---|----------|----------|----------|
| 1 | [名前] | 正常系 | [内容] |
| 2 | [名前] | 異常系 | [内容] |

### カバーされる仕様要件
- [x] [要件1]
- [x] [要件2]

### 未カバーの要件（手動テスト推奨）
- [ ] [要件] - 理由: [自動化困難な理由]

### 実行結果
- 成功: X件
- 失敗: X件（要調整）

### 次のステップ
- 失敗テストがある場合: `/e2e:fix $ARGUMENTS`
- 全て成功した場合: 次機能のテスト生成 または `/e2e:verify-all`
```

## 機能別テスト設計ガイド

### auth（認証）
- ログインページ表示
- Googleボタンの存在・有効性
- 未認証時のリダイレクト
- エラーハンドリング
- 認証キャンセル時の動作

### timeline（タイムライン）
- 投稿一覧の表示
- 日付ヘッダーの操作
- スクロール動作
- 投稿カードのタップ
- カレンダー展開/閉じる

### entry-input（入力/編集）
- 新規投稿作成
- テキスト入力
- 画像添付
- 下書き自動保存
- 編集・更新
- 投稿後のリダイレクト

### streak（ストリーク）
- 継続記録の表示
- ほつれの表示
- ストリーク更新（投稿後）

### mypage（マイページ）
- プロフィール表示
- 継続記録表示
- ほつれ残り表示
- 設定項目
- ログアウト

### notification（通知）
- 通知設定画面
- 時刻設定
- ON/OFF切り替え
