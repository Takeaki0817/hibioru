# E2E完成: 仕様に基づく実装の検証・修正・完成

アプリケーションの全機能を仕様に照らして検証し、不足・問題を修正して完成させる包括的なワークフローを実行します。

## 概要

このスキルは以下のサイクルを自動的に実行します：

```
┌─────────────┐
│  1. 検証    │ ← 全機能のE2Eテスト実行
└──────┬──────┘
       ▼
┌─────────────┐
│  2. 分析    │ ← 仕様とのギャップ特定
└──────┬──────┘
       ▼
┌─────────────┐
│  3. 生成    │ ← 不足テストの生成
└──────┬──────┘
       ▼
┌─────────────┐
│  4. 修正    │ ← 失敗テストの修正
└──────┬──────┘
       ▼
┌─────────────┐
│  5. 再検証  │ ← 修正確認
└──────┬──────┘
       ▼
     完成？ ─No→ [2へ戻る]
       │
      Yes
       ▼
   完了レポート
```

## 実行手順

### Phase 1: 初期検証

1. **環境確認**
   - 開発サーバー起動確認（http://localhost:3000）
   - Supabase起動確認（http://127.0.0.1:54321）

2. **全E2Eテスト実行**
   ```bash
   npx playwright test --reporter=list
   ```

3. **初期状態の記録**
   - 総テスト数
   - 成功/失敗数
   - 機能別の状況

### Phase 2: ギャップ分析

1. **仕様読み込み**
   ```
   docs/REQUIREMENTS.md
   .kiro/specs/*/requirements.md
   .kiro/specs/*/design.md
   ```

2. **カバレッジ分析**
   - 各機能の要件リスト作成
   - 対応テストの有無確認
   - 未カバー要件の特定

3. **優先度付け**
   | 優先度 | 基準 |
   |--------|------|
   | P0 | コア機能（認証、投稿、表示） |
   | P1 | 重要機能（ストリーク、通知） |
   | P2 | 補助機能（設定、エクスポート） |

### Phase 3: テスト生成サイクル

未カバーの機能について、優先度順に以下を実行：

```
for each 未カバー機能:
    1. 仕様を詳細に読み込み
    2. テストケースを設計
    3. テストコードを生成
    4. テストを実行して確認
```

生成対象の機能：
- [ ] auth（認証）
- [ ] timeline（タイムライン）
- [ ] entry-input（入力/編集）
- [ ] streak（ストリーク）
- [ ] mypage（マイページ）
- [ ] notification（通知）

### Phase 4: 修正サイクル

失敗テストについて、以下を実行：

```
while 失敗テストあり:
    1. 失敗原因を分析
    2. 実装 or テストを修正
    3. 該当テストを再実行
    4. 成功したら次の失敗テストへ
```

修正の判断基準：
- **実装が問題**: コードを修正
- **テストが問題**: テストコードを修正
- **仕様が不明確**: ユーザーに確認

### Phase 5: 完成確認

1. **全テスト再実行**
   ```bash
   npx playwright test --reporter=list
   ```

2. **成功基準の確認**
   - [ ] 全テストが成功
   - [ ] Phase 1要件が全てカバー
   - [ ] カバレッジ80%以上

3. **完成レポート生成**

## 完成レポート形式

```markdown
# E2E完成レポート

## 最終結果
🎉 **アプリケーションは仕様を満たしています**

### テスト結果サマリー
| 指標 | 値 |
|------|-----|
| 総テスト数 | X |
| 成功 | X (100%) |
| カバレッジ | XX% |

### 機能別ステータス
| 機能 | ステータス | テスト数 |
|------|-----------|----------|
| auth | ✅ 完了 | 9 |
| timeline | ✅ 完了 | X |
| entry-input | ✅ 完了 | X |
| streak | ✅ 完了 | X |
| mypage | ✅ 完了 | X |
| notification | ✅ 完了 | X |

### 実施した修正
1. [修正内容1]
2. [修正内容2]

### 追加したテスト
1. [テスト1]
2. [テスト2]

### Phase 1 チェックリスト
- [x] Google認証
- [x] 入力/編集ページ
- [x] タイムライン/カレンダーページ
- [x] マイページ
- [x] ストリーク/ほつれロジック
- [x] 画像圧縮・アップロード
- [x] PWA化
- [x] プッシュ通知
- [x] データエクスポートAPI

### 次のステップ
- 本番デプロイの準備
- Phase 2（クローズドβ）の計画
```

## インタラクティブモード

各フェーズ完了時にユーザーに確認を取ります：

1. **初期検証後**
   「X件のテストを実行しました。Y件が失敗しています。修正を進めますか？」

2. **ギャップ分析後**
   「以下の機能のテストが不足しています：[リスト]。テストを生成しますか？」

3. **修正完了後**
   「全ての修正が完了しました。最終確認を実行しますか？」

## 中断と再開

作業を中断する場合：
- 現在の進捗を報告
- 次に実行すべきコマンドを提示

再開時：
- `/e2e:report` で現状確認
- 中断箇所から継続

## 注意事項

- 大規模な修正が必要な場合はユーザーに確認
- 仕様の解釈に迷う場合はユーザーに質問
- 1サイクルで完了しない場合は段階的に進める
- 各修正後は必ず関連テストを実行
