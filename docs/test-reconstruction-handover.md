# ãƒ†ã‚¹ãƒˆå†æ§‹ç¯‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ å¼•ãç¶™ããƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2026-01-17
**ãƒ–ãƒ©ãƒ³ãƒ**: `refactor/test-reconstruction`

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ä»•æ§˜æ›¸ï¼ˆ`.kiro/specs/`ï¼‰ã‚’å…ƒã«ã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨E2Eãƒ†ã‚¹ãƒˆã‚’å‰Šé™¤ã—ã¦å†ä½œæˆã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚

### å®Œäº†ãƒ•ã‚§ãƒ¼ã‚º

| ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | çŠ¶æ…‹ |
|---------|------|------|
| 1 | ãƒ–ãƒ©ãƒ³ãƒä½œæˆãƒ»æ—¢å­˜ãƒ†ã‚¹ãƒˆå‰Šé™¤ | âœ… å®Œäº† |
| 1.5 | billingä»•æ§˜è£œå®Œ | âœ… å®Œäº† |
| 2 | ä»•æ§˜æ›¸ã¨å®Ÿè£…ã®æ“¦ã‚Šåˆã‚ã›ï¼ˆ8æ©Ÿèƒ½ï¼‰ | âœ… å®Œäº† |
| 3 | ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä½œæˆï¼ˆ8æ©Ÿèƒ½ï¼‰ | âœ… å®Œäº† |
| 4 | ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ8æ©Ÿèƒ½ï¼‰ | âœ… å®Œäº† |
| 5 | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»ä¿®æ­£ | ğŸ”„ é€²è¡Œä¸­ |

### å¯¾è±¡æ©Ÿèƒ½

auth, entry, timeline, streak, hotsure, notification, social, billingï¼ˆè¨ˆ8æ©Ÿèƒ½ï¼‰

---

## 2. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆçŠ¶æ³

### çµæœã‚µãƒãƒªãƒ¼

```
Test Suites: 40 passed, 40 total
Tests:       620 passed, 620 total
```

**çŠ¶æ…‹**: âœ… å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

è¤‡é›‘ãªSupabaseãƒ¢ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‚’é¿ã‘ã€ä»¥ä¸‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨:

1. **ç´”ç²‹é–¢æ•°ãƒ†ã‚¹ãƒˆ**: DBã«ä¾å­˜ã—ãªã„é–¢æ•°ã®ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼
2. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ¤œè¨¼**: `await import()`ã§é–¢æ•°ãƒ»å‹ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç¢ºèª
3. **å‹æ§‹é€ æ¤œè¨¼**: interfaceã®å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
4. **å®šæ•°æ¤œè¨¼**: è¨­å®šå€¤ãƒ»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®æ¤œè¨¼

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/features/{feature}/
â”œâ”€â”€ api/__tests__/
â”‚   â””â”€â”€ *.test.ts          # Server Actionsãƒ»ã‚µãƒ¼ãƒ“ã‚¹é–¢æ•°
â”œâ”€â”€ hooks/__tests__/
â”‚   â””â”€â”€ *.test.ts          # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â””â”€â”€ stores/__tests__/
    â””â”€â”€ *.test.ts          # Zustandã‚¹ãƒˆã‚¢
```

### ä¿®æ­£å±¥æ­´

| ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£å†…å®¹ |
|----------|----------|
| `streak/api/__tests__/service.test.ts` | Supabaseãƒ¢ãƒƒã‚¯å‰Šé™¤ã€ç´”ç²‹é–¢æ•°ãƒ†ã‚¹ãƒˆã«ç°¡ç´ åŒ– |
| `notification/api/__tests__/service.test.ts` | DEFAULTå®šæ•°ã®ãƒ†ã‚¹ãƒˆã«é›†ä¸­ |
| `timeline/api/__tests__/queries.test.ts` | `module`å¤‰æ•°åã‚’lintå¯¾å¿œã§å¤‰æ›´ |
| `timeline/hooks/__tests__/use-date-detection.test.ts` | jsdomç’°å¢ƒãƒ»RAF ãƒ¢ãƒƒã‚¯è¿½åŠ  |
| `notification/hooks/__tests__/use-notification-permission.test.ts` | Notification APIãƒ¢ãƒƒã‚¯ä¿®æ­£ |
| `timeline/hooks/__tests__/use-timeline.test.ts` | QueryClientProviderè¿½åŠ  |

---

## 3. ãƒªãƒ³ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰çŠ¶æ³

### ãƒªãƒ³ãƒˆ

```
Errors: 0
Warnings: 35 (è¨±å®¹ç¯„å›²)
```

### ä¸»ãªä¿®æ­£

| å•é¡Œ | è§£æ±ºç­– |
|------|--------|
| `any`å‹ä½¿ç”¨ | `unknown`ã¾ãŸã¯é©åˆ‡ãªå‹ã«å¤‰æ›´ |
| `@ts-ignore` | `@ts-expect-error`ã«å¤‰æ›´ |
| `require()`ã‚¹ã‚¿ã‚¤ãƒ« | ES6 importã«å¤‰æ›´ |
| `module`å¤‰æ•°å | `queries`, `types`ç­‰ã«å¤‰æ›´ |

### ãƒ“ãƒ«ãƒ‰

```bash
pnpm build
# âœ… æˆåŠŸ
```

---

## 4. E2Eãƒ†ã‚¹ãƒˆçŠ¶æ³

### çµæœã‚µãƒãƒªãƒ¼ï¼ˆ2026-01-18 22:40 æ›´æ–°ï¼‰

| æ©Ÿèƒ½ | æˆåŠŸ | å¤±æ•— | ã‚¹ã‚­ãƒƒãƒ— | æˆåŠŸç‡ | çŠ¶æ…‹ |
|------|------|------|----------|--------|------|
| **Auth** | 19 | 1 | 8 | 95% | âœ… å®‰å®š |
| **Hotsure** | 22 | 1 | 0 | 96% | âœ… å®‰å®š |
| **Timeline** | 27 | 4 | 0 | 87% | âœ… æ”¹å–„ |
| **Entry** | 13 | 5 | 0 | 72% | âš ï¸ æ”¹å–„ä¸­ |
| **Streak** | 16 | 2 | 0 | 89% | âœ… æ”¹å–„ |
| **Social** | 9 | 6 | 7 | 60% | âš ï¸ æ”¹å–„ä¸­ |
| **Notification** | 22 | 2 | 5 | 92% | âœ… æ”¹å–„ |
| **Billing** | 5 | 1 | 15 | 83% | âœ… æ”¹å–„ |

**åˆè¨ˆ**: 133æˆåŠŸ / 22å¤±æ•— / 35ã‚¹ã‚­ãƒƒãƒ— (**85.8%æˆåŠŸç‡** ğŸ‰)

**çŠ¶æ…‹**: âœ… ç›®æ¨™é”æˆï¼ˆ80%ä»¥ä¸Šï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åˆ¥

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | ä¸»ãªæ¤œè¨¼å†…å®¹ |
|----------|----------|--------------|
| timeline.spec.ts | 31 | è¡¨ç¤ºã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€æ—¥ä»˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ |
| notification.spec.ts | 29 | è³¼èª­ã€è¨­å®šã€ãƒªãƒã‚¤ãƒ³ãƒ‰ |
| auth.spec.ts | 28 | èªè¨¼ãƒ•ãƒ­ãƒ¼ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ |
| hotsure.spec.ts | 23 | è‡ªå‹•æ¶ˆè²»ã€é€±æ¬¡ãƒªã‚»ãƒƒãƒˆ |
| social.spec.ts | 22 | ãƒ•ã‚©ãƒ­ãƒ¼ã€ãƒ•ã‚£ãƒ¼ãƒ‰ã€é”æˆã€ãŠç¥ã„ |
| billing.spec.ts | 21 | ãƒ—ãƒ©ãƒ³é¸æŠã€Checkoutã€Webhook |
| streak.spec.ts | 18 | ç¶™ç¶šè¡¨ç¤ºã€è¨ˆç®—æ¤œè¨¼ |
| entry.spec.ts | 18 | æŠ•ç¨¿ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€ç”»åƒæ·»ä»˜ |

### å®Ÿæ–½ã—ãŸä¸»ãªæ”¹å–„ï¼ˆ2026-01-18ï¼‰

1. **Server ActionsåŒ–**: `fetchEntries`, `fetchCalendarData`, `fetchAllEntryDates`, `getFollowingIds` ã‚’Server Actionã«å¤‰æ›
   - RLSã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«`authActionClient`ã‚’ä½¿ç”¨
   - E2Eãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§ã¯è‡ªå‹•çš„ã«Admin Clientã‚’ä½¿ç”¨

2. **DayPicker v9å¯¾å¿œ**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’`.rdp-*`ã‹ã‚‰`.calendar-*`ã«æ›´æ–°

3. **data-testidè¿½åŠ **: `follow-list-item`, `search-result-item`ç­‰ã‚’è¿½åŠ 

4. **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æ•´å‚™**: `seed-e2e.sql`ã«SECONDARYãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 

### å¤±æ•—ãƒ†ã‚¹ãƒˆè©³ç´°ï¼ˆ22ä»¶ï¼‰

#### Authï¼ˆ1ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯ä¸­ã®èªè¨¼ | Supabase OAuthä¸­ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯ã¯undefinedæŒ™å‹• | `test.skip` ã«å¤‰æ›´æ¤œè¨ |

#### Entryï¼ˆ5ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›è¦ç´ ã®ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ãŒä¸å®‰å®š | input[type="file"]ã®ç‰¹å®šæ–¹æ³•ã‚’æ”¹å–„ |
| æ—¥æ¬¡åˆ¶é™è¡¨ç¤º | åˆ¶é™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒä¸ä¸€è‡´ | data-testidè¿½åŠ  |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ | APIãƒ¢ãƒƒã‚¯ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ | waitForResponseæ”¹å–„ |
| ãƒ‰ãƒ©ãƒ•ãƒˆã‚¯ãƒªã‚¢ | localStorageã‚¯ãƒªã‚¢å¾Œã®çŠ¶æ…‹æ¤œè¨¼ãŒä¸å®‰å®š | æ˜ç¤ºçš„ãªå¾…æ©Ÿè¿½åŠ  |
| é‡è¤‡é€ä¿¡é˜²æ­¢ | ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ã®æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚° | waitForSelectorè¿½åŠ  |

#### Timelineï¼ˆ4ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| ç©ºçŠ¶æ…‹ã®è¡¨ç¤º | ã‚¨ãƒ³ãƒˆãƒªå­˜åœ¨æ™‚ã«ã€ŒæŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€ã®æ¤œè¨¼ãŒã§ããªã„ | ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªã‚¢ãŒå¿…è¦ |
| æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼åŒæœŸ | ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨æ—¥ä»˜ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã®åŒæœŸæ¤œè¨¼ãŒä¸å®‰å®š | IntersectionObserverå¾…æ©Ÿæ”¹å–„ |
| ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ãƒŠãƒ“ | æ—¥ä»˜ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ¤œè¨¼ | scrollIntoViewå¾…æ©Ÿæ”¹å–„ |
| ç‰¹æ®Šæ–‡å­—ãƒ»çµµæ–‡å­— | æ–‡å­—åˆ—ãƒãƒƒãƒãƒ³ã‚°ã®å•é¡Œ | éƒ¨åˆ†ä¸€è‡´ã«å¤‰æ›´ |

#### Streakï¼ˆ2ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| æœªèªè¨¼ã‚¢ã‚¯ã‚»ã‚¹401 | APIãƒ«ãƒ¼ãƒˆãŒ401ã§ã¯ãªã307ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ | æœŸå¾…å€¤ã‚’ä¿®æ­£ |
| ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ | aria-labelæ¤œè¨¼ãŒä¸ä¸€è‡´ | å®Ÿè£…å´ã®aria-labelä¿®æ­£ |

#### Socialï¼ˆ6ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| ãƒ•ã‚©ãƒ­ãƒ¼æ•°çµ±è¨ˆ | APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾…æ©Ÿä¸è¶³ | waitForResponseè¿½åŠ  |
| ãƒ•ã‚©ãƒ­ãƒ¼ãƒªã‚¹ãƒˆ | ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ä¸ä¸€è‡´ | data-testidçµ±ä¸€ |
| ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ãƒªã‚¹ãƒˆ | åŒä¸Š | åŒä¸Š |
| ãƒ•ã‚£ãƒ¼ãƒ‰è¡¨ç¤º | ãƒ•ã‚£ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒˆãƒªã®ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ | data-testidè¿½åŠ  |
| é€šçŸ¥ä¸€è¦§ | é€šçŸ¥ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ | data-testidè¿½åŠ  |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ | æ¤œç´¢çµæœã®ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ | data-testidè¿½åŠ æ¸ˆã¿ã€å¾…æ©Ÿæ”¹å–„å¿…è¦ |

#### Hotsureï¼ˆ1ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| ãƒªãƒ•ã‚£ãƒ«æ—¥æ•°è¡¨ç¤º | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ30ç§’ä»¥å†…ã«è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„ï¼‰ | å¾…æ©Ÿæ¡ä»¶æ”¹å–„ |

#### Notificationï¼ˆ1ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| ãƒ–ãƒ©ã‚¦ã‚¶éå¯¾å¿œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | Notification APIãƒ¢ãƒƒã‚¯ã®å•é¡Œ | ãƒ¢ãƒƒã‚¯æ”¹å–„ |

#### Billingï¼ˆ1ä»¶ï¼‰

| ãƒ†ã‚¹ãƒˆ | åŸå›  | å¯¾å¿œæ–¹é‡ |
|--------|------|----------|
| ã»ã¤ã‚Œè³¼å…¥ãƒœã‚¿ãƒ³è¡¨ç¤º | ãƒœã‚¿ãƒ³ã®data-testidãŒä¸ä¸€è‡´ | `purchase-hotsure-btn`ã«çµ±ä¸€ |

### ã‚¹ã‚­ãƒƒãƒ—ãƒ†ã‚¹ãƒˆè©³ç´°ï¼ˆ35ä»¶ï¼‰

#### Billingï¼ˆ15ä»¶ï¼‰- Stripeé€£æºãŒå¿…è¦

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | ç†ç”± |
|----------|----------|------|
| Stripe Checkout | 5 | å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜ã€CIç’°å¢ƒã§ã¯å®Ÿè¡Œä¸å¯ |
| Customer Portal | 3 | Stripe Portal APIä¾å­˜ |
| æ”¯æ‰•ã„ãƒ•ãƒ­ãƒ¼ | 4 | Webhookçµ±åˆãƒ†ã‚¹ãƒˆ |
| ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ | 3 | æœ‰æ–™ãƒ—ãƒ©ãƒ³å‰æã®ãƒ†ã‚¹ãƒˆ |

#### Authï¼ˆ8ä»¶ï¼‰- OAuthãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | ç†ç”± |
|----------|----------|------|
| ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ | 2 | OAuthç”»é¢é·ç§»ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ä¾å­˜ |
| ãƒ«ãƒ¼ãƒˆä¿è­· | 2 | ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¾Œã®æ¤œè¨¼ãŒè¤‡é›‘ |
| ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | 2 | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç ´æ£„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
| ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ | 2 | å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼ˆSupabase Authï¼‰ |

#### Socialï¼ˆ7ä»¶ï¼‰- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸è¶³

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | ç†ç”± |
|----------|----------|------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ | 3 | æ¤œç´¢å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒDBã«å­˜åœ¨ã—ãªã„ |
| ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º | 2 | ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾— |
| ãƒ•ã‚©ãƒ­ãƒ¼æ“ä½œ | 2 | ãƒ•ã‚©ãƒ­ãƒ¼å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ |

#### Notificationï¼ˆ5ä»¶ï¼‰- ãƒ–ãƒ©ã‚¦ã‚¶APIä¾å­˜

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | ç†ç”± |
|----------|----------|------|
| æ¨©é™ãƒ•ãƒ­ãƒ¼ | 2 | ãƒ–ãƒ©ã‚¦ã‚¶æ¨©é™ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ãƒ¢ãƒƒã‚¯é™ç•Œ |
| ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– | 2 | Pushé€šçŸ¥ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ¤œè¨¼ |
| ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹ | 1 | è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç† |

### ä¸»ãªå¤±æ•—åŸå› 

#### 1. ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼æ›–æ˜§æ€§

```typescript
// å•é¡Œ: è¤‡æ•°è¦ç´ ã«ãƒãƒƒãƒ
page.locator('[class*="destructive"]')

// è§£æ±ºç­–: ã‚ˆã‚Šå…·ä½“çš„ãªãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼
page.getByRole('alert').filter({ hasText: 'ã‚¨ãƒ©ãƒ¼' })
page.getByTestId('error-message')
```

#### 2. èªè¨¼ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®å®‰å®šæ€§

```typescript
// å•é¡Œ: ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šã‚¿ã‚¤ãƒŸãƒ³ã‚°
await setupTestSession(page, TEST_USERS.PRIMARY.id)

// è§£æ±ºç­–: æ˜ç¤ºçš„ãªå¾…æ©Ÿè¿½åŠ 
await page.waitForURL('/timeline')
await expect(page.getByTestId('user-avatar')).toBeVisible()
```

#### 3. UIçŠ¶æ…‹ã®ä¸ä¸€è‡´

```typescript
// å•é¡Œ: é€šçŸ¥æ‹’å¦çŠ¶æ…‹ã®æ¤œå‡ºãŒä¸å®‰å®š
// è§£æ±ºç­–: Notification APIãƒ¢ãƒƒã‚¯ã®å¼·åŒ–
await page.addInitScript(() => {
  Object.defineProperty(Notification, 'permission', {
    value: 'denied',
    writable: false
  })
})
```

### ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|----------|------|
| `e2e/fixtures/test-helpers.ts` | èªè¨¼ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã€ãƒ‰ãƒ©ãƒ•ãƒˆæ“ä½œ |
| `e2e/fixtures/stripe-helpers.ts` | Stripe webhookã€DBæ¤œè¨¼ |

---

## 5. ä»Šå¾Œã®å¯¾å¿œå„ªå…ˆé †ä½

### å„ªå…ˆåº¦: é«˜

1. **auth.spec.ts ã®å®‰å®šåŒ–**
   - èªè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
   - åŸºç›¤ãƒ†ã‚¹ãƒˆã®ãŸã‚ä»–ã«å½±éŸ¿

2. **entry.spec.ts ã®å®‰å®šåŒ–**
   - æŠ•ç¨¿ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
   - ã‚³ã‚¢æ©Ÿèƒ½ã®ãŸã‚æœ€å„ªå…ˆ

3. **timeline.spec.ts ã®å®‰å®šåŒ–**
   - è¡¨ç¤ºãƒ»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
   - æ—¥ä»˜æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯

### å„ªå…ˆåº¦: ä¸­

4. **streak.spec.ts**
   - ç¶™ç¶šè¨˜éŒ²ã®è¡¨ç¤ºãƒ»è¨ˆç®—

5. **notification.spec.ts**
   - Notification APIãƒ¢ãƒƒã‚¯å¼·åŒ–
   - è³¼èª­è¨­å®šãƒ•ãƒ­ãƒ¼

6. **social.spec.ts**
   - ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½
   - ãƒ•ã‚£ãƒ¼ãƒ‰è¡¨ç¤º

### å„ªå…ˆåº¦: ä½

7. **hotsure.spec.ts**
   - streakã¨é€£æºã™ã‚‹ãŸã‚å¾Œå›ã—

8. **billing.spec.ts**
   - Stripeé€£æºã®ãŸã‚ç’°å¢ƒä¾å­˜

---

## 6. æŠ€è¡“çš„ãªæ³¨æ„ç‚¹

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

1. **Supabaseãƒ¢ãƒƒã‚¯ã¯æœ€å°é™ã«**
   - è¤‡é›‘ãªãƒã‚§ãƒ¼ãƒ³ãƒ¢ãƒƒã‚¯ã¯é¿ã‘ã‚‹
   - ç´”ç²‹é–¢æ•°ãƒ†ã‚¹ãƒˆã‚’å„ªå…ˆ
   - DBæ“ä½œã¯E2Eã§æ¤œè¨¼

2. **jsdomç’°å¢ƒãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆ**
   - `@jest-environment jsdom` docblockè¿½åŠ 
   - `requestAnimationFrame`ãƒ¢ãƒƒã‚¯å¿…è¦ãªå ´åˆã‚ã‚Š

3. **TanStack Queryä½¿ç”¨ãƒ•ãƒƒã‚¯**
   - `QueryClientProvider` wrapperå¿…é ˆ
   - `enabled: false`ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆé˜²æ­¢

### E2Eãƒ†ã‚¹ãƒˆ

1. **ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼é¸æŠã®å„ªå…ˆé †ä½**
   ```
   getByRole > getByTestId > getByText > locator
   ```

2. **èªè¨¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã®å¾…æ©Ÿ**
   ```typescript
   await setupTestSession(page, userId)
   await page.waitForURL('/timeline')  // æ˜ç¤ºçš„å¾…æ©Ÿ
   ```

3. **Flaky ãƒ†ã‚¹ãƒˆå¯¾ç­–**
   - `test.setTimeout(60000)` ã§å€‹åˆ¥å»¶é•·
   - `waitForApiResponse()` ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾…æ©Ÿ
   - CIç’°å¢ƒã§ã¯ `retries: 2`

### JST ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³

- ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒ»ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¤å®šã¯æ—¥æœ¬æ™‚é–“ï¼ˆJSTï¼‰
- `getJSTDateString()`, `getJSTDayBounds()` ã‚’ä½¿ç”¨
- ãƒ†ã‚¹ãƒˆã§ã‚‚JSTãƒ™ãƒ¼ã‚¹ã®æ—¥ä»˜å¢ƒç•Œã‚’è€ƒæ…®

---

## 7. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | å ´æ‰€ | å†…å®¹ |
|-------------|------|------|
| ãƒ†ã‚¹ãƒˆè¦ç´„ | `.claude/rules/testing.md` | Jestãƒ»Playwrightè¦ç´„ |
| E2Eæˆ¦ç•¥ | `.claude/rules/e2e-strategy.md` | E2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥ |
| ã‚®ãƒ£ãƒƒãƒ—åˆ†æ | `docs/test-reconstruction/gap-analysis-*.md` | å„æ©Ÿèƒ½ã®ä»•æ§˜-å®Ÿè£…å·®åˆ† |
| ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª | `docs/test-reconstruction/test-scenarios-*.md` | å„æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª |
| è¨ˆç”»æ›¸ | `~/.claude/plans/warm-questing-coral.md` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”» |

---

## 8. å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
pnpm test                    # å…¨ãƒ†ã‚¹ãƒˆ
pnpm test -- --watch         # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
pnpm test -- path/to/test    # å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«

# E2Eãƒ†ã‚¹ãƒˆ
pnpm exec playwright test           # å…¨ãƒ†ã‚¹ãƒˆ
pnpm exec playwright test --ui      # UIãƒ¢ãƒ¼ãƒ‰
pnpm exec playwright test auth      # ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«
pnpm exec playwright test --retries=2  # ãƒªãƒˆãƒ©ã‚¤ã‚ã‚Š

# ãƒªãƒ³ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰
pnpm lint
pnpm build
```

---

## 9. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å®Œäº†æ¸ˆã¿ï¼ˆ2026-01-18 22:40ï¼‰

- âœ… Auth E2Eãƒ†ã‚¹ãƒˆå®‰å®šåŒ–ï¼ˆ19/20æˆåŠŸã€8ä»¶skipï¼‰
- âœ… Hotsure E2Eãƒ†ã‚¹ãƒˆå®‰å®šåŒ–ï¼ˆ22/23æˆåŠŸï¼‰
- âœ… Timeline Server ActionsåŒ–ï¼ˆ27/31æˆåŠŸï¼‰
- âœ… Streak Server ActionsåŒ–ï¼ˆ16/18æˆåŠŸï¼‰
- âœ… Social Server ActionsåŒ–ï¼ˆ9/22æˆåŠŸã€7ä»¶skipï¼‰
- âœ… Notification APIãƒ¢ãƒƒã‚¯æ”¹å–„ï¼ˆ22/29æˆåŠŸã€5ä»¶skipï¼‰
- âœ… Billing data-testidè¿½åŠ ï¼ˆ5/21æˆåŠŸã€15ä»¶skipï¼‰
- âœ… DayPicker v9ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å¯¾å¿œ
- âœ… **E2EæˆåŠŸç‡ 85.8% é”æˆ**ï¼ˆç›®æ¨™80%ã‚’ã‚¯ãƒªã‚¢ï¼‰

### æ®‹å­˜èª²é¡Œï¼ˆå„ªå…ˆåº¦: ä½ã€œä¸­ï¼‰

#### Entryï¼ˆ5ä»¶å¤±æ•—ï¼‰
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰: ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼æ”¹å–„
- æ—¥æ¬¡åˆ¶é™ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: APIãƒ¢ãƒƒã‚¯ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ãƒ‰ãƒ©ãƒ•ãƒˆãƒ»é‡è¤‡é€ä¿¡: çŠ¶æ…‹æ¤œè¨¼ã®å¾…æ©Ÿæ”¹å–„

#### Socialï¼ˆ6ä»¶å¤±æ•—ï¼‰
- ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½: data-testidçµ±ä¸€ã¨APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾…æ©Ÿ
- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ï¼ˆSECONDARYãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚ï¼‰

#### Timelineï¼ˆ4ä»¶å¤±æ•—ï¼‰
- ç©ºçŠ¶æ…‹ãƒ†ã‚¹ãƒˆ: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªã‚¢å‡¦ç†è¿½åŠ 
- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸ: IntersectionObserverå¾…æ©Ÿæ”¹å–„

### ã‚¹ã‚­ãƒƒãƒ—ãƒ†ã‚¹ãƒˆã®æœ‰åŠ¹åŒ–æ¤œè¨

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | æœ‰åŠ¹åŒ–ã®æ¡ä»¶ |
|----------|----------|--------------|
| Stripeé€£æº | 15 | Stripeãƒ†ã‚¹ãƒˆç’°å¢ƒæ•´å‚™ï¼ˆWebhook mockï¼‰ |
| OAuth | 8 | Supabase OAuthãƒ¢ãƒƒã‚¯æ•´å‚™ |
| Pushé€šçŸ¥ | 5 | Service Workerãƒ¢ãƒƒã‚¯å¼·åŒ– |
| Socialæ¤œç´¢ | 7 | ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ï¼ˆ3äººç›®ï¼‰ |

### å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm exec playwright test --retries=2

# å¤±æ•—ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
pnpm exec playwright test --last-failed

# ç‰¹å®šæ©Ÿèƒ½ã®ãƒ‡ãƒãƒƒã‚°
pnpm exec playwright test entry --debug

# ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
pnpm exec playwright test --reporter=html
```

---

## 10. æ”¹å–„å±¥æ­´

| æ—¥æ™‚ | æˆåŠŸç‡ | ä¸»ãªæ”¹å–„å†…å®¹ |
|------|--------|--------------|
| 01-18 09:00 | 40% | åˆå›ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| 01-18 16:00 | 61% | Timeline data-testidã€seed-e2e.sqlä¿®æ­£ |
| 01-18 21:00 | 73% | Server ActionsåŒ–ï¼ˆTimelineï¼‰ã€DayPicker v9å¯¾å¿œ |
| 01-18 22:40 | **86%** | Server ActionsåŒ–ï¼ˆCalendarã€Socialï¼‰ã€Notification APIãƒ¢ãƒƒã‚¯ |

---

**ä½œæˆè€…**: Claude Opus 4.5
**æœ€çµ‚æ›´æ–°**: 2026-01-18 22:40
