# ヒビオル 要件定義書

## 概要

**サービス名**: ヒビオル（hibioru）
**コンセプト**: 「日々を織る」- ADHD当事者のための瞬間記録アプリ

Twitter的な投稿感覚で、日々の瞬間をログとして残す。
継続することが最大の目的。立派な日記を書くことではない。

---

## 用語定義

| 用語 | 意味 |
|------|------|
| **ヒビオル** | サービス名（日々を織る） |
| **ほつれ** | 継続を守るためのスキップ機能 |
| **ほつれ直し** | ほつれを使って途切れを防ぐこと |

---

## ターゲットユーザー

- ADHD当事者、またはADHD傾向のある人
- 日記やログを続けたいが続かない人
- 手軽に日々の記録を残したい人

---

## 解決する課題

| 課題 | 対策 |
|------|------|
| メンタル落ちると書けない | プッシュ通知 + 最小入力（絵文字1つでOK） |
| 忘れる | 定時リマインド + 追いリマインド |
| 継続の意味を見失う | 継続記録表示、AI連携での振り返り |
| 1ヶ月で新鮮さが消える | ゲーミフィケーション（継続記録、ほつれ） |
| スマホで操作しづらい | PWA、2タップで記録完了 |
| デザインが堅い | 軽い見た目、遊び心のある用語 |

---

# 機能要件

## ストリーク（継続記録）ルール

| 項目 | 仕様 |
|------|------|
| 日付切り替え | 毎日 0:00 |
| 継続判定 | その日に1件以上の記録があればOK |
| 途切れた場合 | current_streak → 0、longest_streak は保持 |
| 復活アイテム | 少額課金で購入可（Phase 4以降） |

## ほつれ（スキップ機能）ルール

| 項目 | 仕様 |
|------|------|
| 付与数 | 週2回 |
| リセット | 毎週月曜 0:00 |
| 繰り越し | なし（最大2個） |
| 使用方法 | 自動消費（記録がない日に自動で使用） |
| アイコン | 🧵 |

## 入力機能

| 項目 | ベータ版 | 本番 |
|------|---------|------|
| 1日の投稿数 | 20件 | βデータで決定 |
| 画像枚数 | 1投稿1枚、1日5枚まで | βデータで決定 |
| 画像サイズ | 圧縮後200KB以下 | 同左 |
| 編集可能期間 | 24時間以内 | 同左 |
| 削除 | 可能（論理削除） | 同左 |
| テキスト形式 | プレーンテキスト | マークダウン対応（追加実装） |
| 下書き | ローカルストレージに自動保存 | 同左 |

---

# 画面設計

## 画面一覧

```
1. ログイン画面 (/login)
2. 入力/編集ページ (/new, /edit/[id])
3. タイムライン/カレンダーページ (/) ← メイン
4. マイページ (/mypage)
```

---

## 1. ログイン画面 (/login)

```
┌─────────────────────────────────┐
│                                 │
│                                 │
│         ヒビオル                │
│       「日々を織る」            │
│                                 │
│                                 │
│    [Googleでログイン]           │
│                                 │
│                                 │
└─────────────────────────────────┘
```

- Googleログインボタンのみ
- シンプルなコピー

---

## 2. 入力/編集ページ (/new, /edit/[id])

```
┌─────────────────────────────────┐
│ [←戻る]              [投稿する] │
├─────────────────────────────────┤
│                                 │
│                                 │
│   （全画面入力エリア）          │
│                                 │
│   プレーンテキスト              │
│   プレースホルダー:             │
│   「今日はどんな一日？」        │
│                                 │
│                                 │
│                                 │
├─────────────────────────────────┤
│ [📷画像]                        │
└─────────────────────────────────┘
```

### 仕様

| 項目 | 仕様 |
|------|------|
| 入力エリア | 画面全体、集中モード |
| 画像添付 | ボタンから選択、圧縮してアップロード |
| 編集 | 同じ画面、同IDに上書き |
| 下書き保存 | ローカルストレージに自動保存（他画面遷移しても消えない） |

### 画面遷移

```
新規: /new → 投稿 → タイムラインへ戻る
編集: タイムラインで投稿タップ → /edit/[id] → 更新 → タイムラインへ戻る
```

---

## 3. タイムライン/カレンダーページ (/)

```
┌─────────────────────────────────┐
│                                 │
│  ◀ 14  15 [16] 17  18 ▶  [📅]  │  ← 日付ヘッダー
│         今日                    │
├─────────────────────────────────┤
│                                 │
│  ┌ 12月16日（月）─────────────┐ │
│  │                            │ │
│  │  22:15                     │ │
│  │  明日の準備完了 ✅          │ │
│  │                            │ │
│  │  ───────────────────────   │ │
│  │                            │ │
│  │  18:30                     │ │
│  │  焼肉きんぐ最高🍖           │ │
│  │  [画像サムネイル]          │ │
│  │                            │ │
│  └────────────────────────────┘ │
│                                 │
│  ↓ スクロールで前日へ           │
│                                 │
├─────────────────────────────────┤
│            [＋]                 │  ← 新規投稿FAB
├─────────────────────────────────┤
│  [タイムライン]     [マイページ] │
└─────────────────────────────────┘
```

### 日付ヘッダー

| 操作 | 動作 |
|------|------|
| 左右スワイプ | 日付が移動、タイムラインもその日にジャンプ |
| 📅タップ | 月カレンダーが展開 |
| 日付タップ | その日の最終投稿位置へスクロール |

### タイムライン

| 項目 | 仕様 |
|------|------|
| 表示順序 | 新しい順（上が新しい） |
| スクロール | 日付をまたいで連続スクロール |
| スナップ | 日付単位でスナップアニメーション |
| 日付同期 | スクロール位置とヘッダーの日付が同期 |
| デフォルト表示 | 今日の最終投稿位置 |
| 空の日 | スキップ（日付ヘッダーにほつれマーク🧵） |

### 投稿カード操作

| 操作 | 動作 |
|------|------|
| タップ | 編集ページへ (/edit/[id]) |
| 長押し | メニュー表示（削除など） |

### 月カレンダー（展開時）

```
      12月 2025
日  月  火  水  木  金  土
        1   2   3   4   5
            ●   ●━━●
        6   7   8   9  10  11  12
        ●━━●━━●━━🧵  ●━━●━━●
                ほつれ
       13  14  15  16  17  18  19
        ●━━●━━●   ◎
                   今日
```

| 表示 | 意味 |
|------|------|
| ● | 記録あり（中に件数表示） |
| ━━ | 継続（線でつながる） |
| 🧵 | ほつれ使用日 |
| ◎ | 今日 |
| （空白） | 記録なし・途切れ |

---

## 4. マイページ (/mypage)

```
┌─────────────────────────────────┐
│         マイページ              │
├─────────────────────────────────┤
│                                 │
│   [アバター]                    │
│   ユーザー名                    │
│                                 │
├─────────────────────────────────┤
│                                 │
│   🔥 現在の継続記録             │
│      12日                       │
│                                 │
│   🏆 最長記録                   │
│      45日                       │
│                                 │
│   🧵 ほつれ残り                 │
│      2回                        │
│                                 │
├─────────────────────────────────┤
│                                 │
│   [🔔 通知設定]                 │
│   [📤 データエクスポート]       │
│   [🚪 ログアウト]               │
│                                 │
└─────────────────────────────────┘
```

---

# プッシュ通知設計

## 重要性

ADHD当事者にとって「忘れる」「自分から動けない」が最大の障壁。
プッシュ通知は継続の生命線。

## ユーザー設定項目

```typescript
interface NotificationSettings {
  // 基本リマインド
  enabled: boolean;
  primaryTime: string;        // 例: "21:00"
  timezone: string;           // 例: "Asia/Tokyo"
  
  // 追いリマインド
  followUpEnabled: boolean;
  followUpIntervalMinutes: number;  // 例: 60（1時間後）
  followUpMaxCount: number;         // 例: 2（最大2回まで）
  
  // 曜日設定（任意）
  activeDays: number[];       // 例: [0,1,2,3,4,5,6] 全曜日
}
```

## 追いリマインドのロジック

```
[primaryTime] メインリマインド送信
     ↓
  記録あり？ → Yes → 終了（その日は通知しない）
     ↓ No
[primaryTime + interval] 追いリマインド1回目
     ↓
  記録あり？ → Yes → 終了
     ↓ No
[さらに + interval] 追いリマインド2回目（maxCountまで）
     ↓
  maxCount到達 → 終了（しつこくしすぎない）
```

## デフォルト値

| 項目 | デフォルト | 理由 |
|------|-----------|------|
| primaryTime | 21:00 | 夜、一日を振り返るタイミング |
| followUpInterval | 60分 | 短すぎると鬱陶しい、長すぎると寝てしまう |
| followUpMaxCount | 2回 | 3回以上は逆効果（通知疲れ） |

## 通知文言（バリエーション）

**メインリマインド**
- 「今日はどんな一日だった？」
- 「一言だけでも残しておこう」
- 「絵文字1つでもOK 📝」

**追いリマインド1回目**
- 「まだ間に合うよ」
- 「30秒で終わる」

**追いリマインド2回目（最後）**
- 「今日の最後のチャンス」
- 「ほつれ使う？🧵」← ほつれへの導線

---

# オンボーディング

## 通知許可のタイミング

**アンチパターン：**
- 初回起動直後に許可を求める
- 理由を説明せずに求める

**推奨：価値を感じた後に求める（2〜3回記録後）**

## フロー

```
[1] スプラッシュ / ログイン
    「日々を織る」
    [Googleでログイン]
        ↓
[2] コンセプト説明（1画面、スキップ可）
    「毎日ひとこと、絵文字1つでもOK」
    「続けることが大事」
        ↓
[3] 最初の記録を促す
    「さっそく今日のことを書いてみよう」
    [入力欄]
        ↓
[4] タイムライン画面へ
    継続記録1日目🔥
        ↓
[5] 2〜3回目の記録後
    「通知で継続をサポートしますか？」
    [通知を許可] [あとで]
        ↓
    許可した場合 → 通知設定画面へ（時刻選択）
```

## 通知許可の文言

```
┌─────────────────────────────────┐
│                                 │
│   🔔 通知で継続をサポート       │
│                                 │
│   忘れそうな時にリマインド。    │
│   1日1回、設定した時間に届くよ。│
│                                 │
│   [通知を設定する]              │
│   [あとで]                      │
│                                 │
└─────────────────────────────────┘
```

---

# AI連携

## 目的

本人の投稿データをAI（Claude等）に渡して振り返りや分析に活用する。

## API設計

```
GET /api/entries?from=2025-01-01&to=2025-01-31
→ JSON配列で返す

GET /api/export?format=markdown
→ Markdown形式でダウンロード

GET /api/export?format=json
→ JSON形式でダウンロード
```

## MCP対応（Phase 2以降）

MCPサーバーを別途作成し、上記APIを叩く形で実装。

---

# データ設計

## テーブル構成

```sql
-- ユーザー（Supabase Auth + 拡張）
users
├── id (uuid, PK)
├── email (text)
├── display_name (text)
├── avatar_url (text, nullable)
├── created_at (timestamptz)

-- 記録エントリー
entries
├── id (uuid, PK)
├── user_id (uuid, FK → users)
├── content (text)
├── image_url (text, nullable)
├── is_public (boolean, default false)
├── is_deleted (boolean, default false)
├── created_at (timestamptz)
├── updated_at (timestamptz)

-- 継続記録管理
streaks
├── user_id (uuid, PK, FK → users)
├── current_streak (int, default 0)
├── longest_streak (int, default 0)
├── last_entry_date (date)
├── hotsure_remaining (int, default 2)  -- ほつれ残り
├── hotsure_used_dates (date[])         -- ほつれ使用日

-- 通知設定
notification_settings
├── user_id (uuid, PK, FK → users)
├── enabled (boolean, default true)
├── primary_time (time, default '21:00')
├── timezone (text, default 'Asia/Tokyo')
├── follow_up_enabled (boolean, default true)
├── follow_up_interval_minutes (int, default 60)
├── follow_up_max_count (int, default 2)
├── active_days (int[], default '{0,1,2,3,4,5,6}')
├── updated_at (timestamptz)

-- プッシュ購読情報（デバイスごと）
push_subscriptions
├── id (uuid, PK)
├── user_id (uuid, FK → users)
├── endpoint (text)
├── p256dh (text)
├── auth (text)
├── device_name (text, nullable)
├── created_at (timestamptz)
├── last_used_at (timestamptz)

-- 通知送信履歴（デバッグ・分析用）
notification_logs
├── id (uuid, PK)
├── user_id (uuid, FK → users)
├── type (text) -- 'primary' | 'follow_up_1' | 'follow_up_2'
├── sent_at (timestamptz)
├── result (text) -- 'success' | 'failed'
├── entry_recorded_at (timestamptz, nullable)
```

## Phase 3 追加テーブル（ソーシャル機能）

```sql
-- フレンド関係
friendships
├── id (uuid, PK)
├── requester_id (uuid, FK → users)
├── addressee_id (uuid, FK → users)
├── status (text) -- 'pending' | 'accepted'
├── created_at (timestamptz)

-- リアクション
reactions
├── id (uuid, PK)
├── entry_id (uuid, FK → entries)
├── user_id (uuid, FK → users)
├── emoji (text)
├── created_at (timestamptz)

-- 継続記録応援
cheers
├── id (uuid, PK)
├── from_user_id (uuid, FK → users)
├── to_user_id (uuid, FK → users)
├── streak_count (int)
├── created_at (timestamptz)
```

---

# 技術スタック

| 項目 | 選定 |
|------|------|
| フレームワーク | Next.js（App Router） |
| 言語 | TypeScript |
| スタイリング | Tailwind CSS |
| バックエンド/DB | Supabase（PostgreSQL） |
| 認証 | Google OAuth（Supabase Auth） |
| ホスティング | Vercel |
| 画像処理 | browser-image-compression（クライアント側WebP変換） |

---

# フェーズ計画

## Phase 1：自分用MVP（1ヶ月）

- [ ] Next.js + Supabase + Vercel構築
- [ ] Google認証
- [ ] 入力/編集ページ
- [ ] タイムライン/カレンダーページ
- [ ] マイページ（継続記録表示）
- [ ] ストリーク/ほつれロジック
- [ ] 画像圧縮・アップロード
- [ ] PWA化
- [ ] プッシュ通知（メインリマインド）
- [ ] データエクスポートAPI

## Phase 2：クローズドβ（1-2ヶ月）

- [ ] 周囲のADHD傾向の仕事仲間に使ってもらう
- [ ] フィードバック収集
- [ ] バグ修正・UX改善
- [ ] 追いリマインド実装
- [ ] 制限値の調整（βデータに基づく）

## Phase 3：ソーシャル機能

**設計思想**
- SNS化しない（無限スクロール、いいね数表示、おすすめなし）
- 比較・競争を煽らない
- 報酬は「継続」に対してのみ
- 相互フォローのみ

**機能**
- [ ] フレンド（相互フォローのみ）
- [ ] 継続記録共有・応援（スタンプ）
- [ ] 投稿の公開設定（デフォルト非公開）
- [ ] リアクション（スタンプのみ）

## Phase 4：ローンチ

- [ ] LP作成
- [ ] Product Hunt / X で公開
- [ ] Supabase Proプラン移行（$25/月）
- [ ] マネタイズ機能実装

---

# マネタイズ設計

## 方針

- Phase 1-3（MVP〜β）: 無料、制限なし
- Phase 4（ローンチ）: βテストのデータを元に制限値を決定し実装
- 目標: サーバー維持費（月$25〜）を賄う

## プラン構成（案）

### 無料プラン

| 項目 | 制限 |
|------|------|
| 投稿数 | 5件/日 |
| 画像 | 10枚/月 |
| ほつれ | 週2回（自動消費） |

カジュアルユーザーには十分な制限。

### プレミアムプラン（月300〜500円）

| 項目 | 内容 |
|------|------|
| 投稿数 | 無制限 |
| 画像 | 無制限 |
| ほつれ | 無制限 |

### 単発課金

| アイテム | 価格 |
|---------|------|
| ストリーク復活 | 200円/回 |
| ほつれ追加（3回分） | 100円 |

## 収益目標

月$25（約3,800円）= Supabase Proプラン維持費

| シナリオ | 達成方法 |
|----------|----------|
| プレミアム8人 | 500円 × 8 = 4,000円 |
| プレミアム5人 + 復活10回 | 500円×5 + 200円×10 = 4,500円 |

## 注意事項

- 制限値はβテストのデータを元に最終決定
- 無料で十分使えることを維持する（課金圧を強くしない）
- ADHD当事者にストレスを与えない設計を優先

---

# Supabase無料枠

| 項目 | 無料枠 | 備考 |
|------|--------|------|
| DB | 500MB | 日記なら数年分OK |
| Storage | 1GB | 100KB/枚で約10,000枚（10年分） |
| Egress | 10GB/月 | 画像表示頻度に注意 |
| MAU | 10,000 | 十分 |

**注意：1週間非アクティブで自動停止**
→ 本番運用時はProプラン（$25/月）に移行

---

# 過去の挫折から学んだこと

## Obsidianでの記録（2025年7-10月）

**継続状況**
- 7/14〜8/9：約4週間、ほぼ毎日継続
- 8/9以降：急激に頻度低下
- 10/3が最後

**挫折要因**
1. GitHub同期でトラブル
2. スマホでの操作が不便
3. デザインが堅苦しい
4. メンタル落ちると書けない
5. 継続の意味を見失う

**良かった点**
- 文量に拘らず雑多に箇条書きで書く構成
- 文章で書きたいときだけ書く場所がある

→ これらの学びをヒビオルの設計に反映
