# ギャップ分析レポート: entry

## 概要

| 項目 | 状況 |
|------|------|
| 仕様書 | `.kiro/specs/entry/requirements.md`, `design.md`, `tasks.md` |
| 実装 | `src/features/entry/` |
| 分析日 | 2026-01-17 |

## ギャップ一覧

### 1. 日次投稿制限の不一致

| 項目 | 内容 |
|------|------|
| 仕様 | 20件/日 |
| 実装 | 15件/日 |
| 優先度 | 高 |
| 影響 | ユーザー体験・ビジネスロジック |

**関連ファイル**: `src/features/billing/constants.ts`

```typescript
// 現状
DAILY_ENTRY_LIMIT: 15

// 仕様
DAILY_ENTRY_LIMIT: 20
```

**対応案**: 仕様または実装のどちらかに統一（ビジネス判断が必要）

### 2. 画像添付制限の不一致

| 項目 | 内容 |
|------|------|
| 仕様 | 5枚/日 |
| 実装 | 5枚/月 |
| 優先度 | 高 |
| 影響 | プランの価値・ユーザー体験 |

**関連ファイル**: `src/features/billing/constants.ts`

**対応案**: 仕様または実装のどちらかに統一（ビジネス判断が必要）

### 3. 下書き保存の編集モード非対応

| 項目 | 内容 |
|------|------|
| 仕様 | 作成・編集両モードで下書き保存 |
| 実装 | 作成モードのみ対応 |
| 優先度 | 中 |
| 影響 | 編集中の入力消失リスク |

**関連ファイル**: `src/features/entry/components/entry-form.tsx`

**対応案**: 編集モード時も `saveDraft()` を呼び出すよう修正

### 4. isShared機能の仕様書未記載

| 項目 | 内容 |
|------|------|
| 仕様 | 記載なし |
| 実装 | `isShared` フラグで公開/非公開を制御 |
| 優先度 | 低 |
| 影響 | 仕様書の網羅性 |

**対応案**: 仕様書に `isShared` 機能を追記

### 5. テスト未実装

| 項目 | 内容 |
|------|------|
| 仕様 | ユニットテスト・E2Eテスト |
| 実装 | 未実装（削除済み） |
| 優先度 | 高 |
| 影響 | 品質保証 |

## 仕様書更新の必要性

| 項目 | 更新内容 |
|------|---------|
| isShared | ソーシャル公開機能を仕様書に追記 |
| 制限値 | 実装値に合わせて更新、または実装を修正 |

## テスト観点

### ユニットテスト

- [ ] `service.ts`: createEntry, updateEntry, deleteEntry
- [ ] 日次制限チェック（プラン別）
- [ ] 画像添付制限チェック（プラン別）
- [ ] 下書き保存・復元

### E2Eテスト

- [ ] 投稿作成フロー（テキスト・絵文字）
- [ ] 画像添付フロー
- [ ] 投稿編集フロー
- [ ] 投稿削除フロー
- [ ] 制限到達時のUI表示
- [ ] 下書き保存・復元

## 結論

日次投稿制限（15 vs 20）と画像添付制限（月 vs 日）の不一致は**ビジネス判断が必要**。テスト作成前にプロダクトオーナーと確認すべき。
