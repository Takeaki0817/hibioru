# ギャップ分析レポート: notification

## 概要

| 項目 | 状況 |
|------|------|
| 仕様書 | `.kiro/specs/notification/requirements.md`, `design.md`, `tasks.md` |
| 実装 | `src/features/notification/` |
| 分析日 | 2026-01-17 |

## ギャップ一覧

### 1. 通知クリック先の不一致

| 項目 | 内容 |
|------|------|
| 仕様 | クリック時に `/new`（投稿画面）へ遷移 |
| 実装 | `/`（ホーム）へ遷移 |
| 優先度 | 中 |
| 影響 | ユーザー導線、投稿促進効果 |

**関連ファイル**: Service Worker または通知送信ロジック

**対応案**: 通知の `url` パラメータを `/new` に修正

### 2. reminder_index 未ログ

| 項目 | 内容 |
|------|------|
| 仕様 | どのリマインダーが送信されたかログに記録 |
| 実装 | `reminder_index` がログに出力されていない |
| 優先度 | 低 |
| 影響 | デバッグ・分析の困難さ |

**関連ファイル**: `src/features/notification/types.ts:123-124`

**対応案**: ログ出力に `reminder_index` を追加

### 3. activeDays UI 未実装

| 項目 | 内容 |
|------|------|
| 仕様 | 曜日ごとの通知ON/OFF設定UI |
| 実装 | 未実装（設定画面に曜日選択UIなし） |
| 優先度 | 中 |
| 影響 | 通知カスタマイズ機能の欠落 |

**関連ファイル**: `src/features/notification/components/`

**対応案**: 曜日選択UIを設定画面に追加

### 4. APIエンドポイントパスの不一致

| 項目 | 内容 |
|------|------|
| 仕様 | `/api/notification/subscribe`, `/api/notification/settings` |
| 実装 | 一部パスが異なる可能性 |
| 優先度 | 低 |
| 影響 | ドキュメントとの整合性 |

**対応案**: 仕様書を実装に合わせて更新

### 5. テスト未実装

| 項目 | 内容 |
|------|------|
| 仕様 | ユニットテスト・E2Eテスト |
| 実装 | 未実装（削除済み） |
| 優先度 | 高 |
| 影響 | 品質保証 |

## 仕様書更新の必要性

| 項目 | 更新内容 |
|------|---------|
| APIパス | 実装に合わせてパスを更新 |
| activeDays | 実装ステータスを明記 |

## テスト観点

### ユニットテスト

- [ ] `service.ts`: 購読登録・解除
- [ ] 通知設定の保存・取得
- [ ] リマインダー時刻の計算（JST）
- [ ] 通知送信ロジック

### E2Eテスト

- [ ] 通知許可フロー
- [ ] 通知設定の変更
- [ ] 通知受信（モック）
- [ ] 通知クリック時の遷移

## 結論

通知クリック先の修正（`/` → `/new`）は投稿促進のため重要。activeDays UIは機能として優先度が低い場合、仕様書から削除も検討。
